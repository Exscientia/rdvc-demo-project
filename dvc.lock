schema: '2.0'
stages:
  01_featurise:
    cmd: python -m rdvc_demo_project.stages.01_featurise
    params:
      params.yaml:
        features:
          name: morgan
          config:
            radius: 3
            n_bits: 2048
        split:
          name: shuffle_split
          presets:
            train_fraction: 0.8
            validation_fraction: 0.0
            test_fraction: 0.2
    outs:
    - path: data/featurised
      hash: md5
      md5: d997021304016085f346500561ebc119.dir
      size: 66662
      nfiles: 4
  02_train:
    cmd: python -m rdvc_demo_project.stages.02_train
    deps:
    - path: data/featurised
      hash: md5
      md5: d997021304016085f346500561ebc119.dir
      size: 66662
      nfiles: 4
    params:
      params.yaml:
        model:
          name: lightning_mlp_regressor
          config:
            x_features:
            - smiles::morgan
            y_features:
            - log_solubility
            input_dim: 2048
            hidden_dim: 128
            num_layers: 2
            num_tasks: 1
            trainer:
              accelerator: cpu
              logger:
                name: DVCLiveLogger
                config:
                  dir: metrics/train
              max_epochs: 1
            datamodule:
              train:
                batch_size: 16
            optimizer:
              name: Adam
              config:
                lr: 0.0003
    outs:
    - path: metrics/train/plots
      hash: md5
      md5: 09248a4104eaa93b9c96d1c32392083b.dir
      size: 160
      nfiles: 5
